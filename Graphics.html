<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>View Google Drive Folder</title>
  <script src="https://apis.google.com/js/api.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    h2 {
      text-align: center;
    }
    ul {
      list-style: none;
      padding: 0;
    }
    li {
      margin: 10px 0;
      background: #fff;
      padding: 10px 15px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    button {
      display: block;
      margin: 20px auto;
      padding: 12px 20px;
      font-size: 16px;
      border: none;
      background-color: #007bff;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>

  <h2>üìÅ Google Drive Folder Viewer</h2>
  <button onclick="requestAccessToken()">Load Folder Contents</button>
  <ul id="fileList"></ul>

  <script>
    const CLIENT_ID = '608102270412-d1tjhndp3q70b1huig7ulqdmh4uobi5i.apps.googleusercontent.com';
    const API_KEY = 'AIzaSyDWC0fqICusytSBgOqFqtQx0EGpVGP5AFY';
    const SCOPES = 'https://www.googleapis.com/auth/drive.readonly';
    const FOLDER_ID = '1ET36NM5uLHZ5OS1ZsVRN3kN0NOaEyvbL';

    let tokenClient;
    let accessToken = null;

    function gisInit() {
      tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: CLIENT_ID,
        scope: SCOPES,
        callback: (response) => {
          if (response.error) {
            alert("Authentication failed.");
            return;
          }
          accessToken = response.access_token;
          listFolderContents();
        }
      });
    }

    function requestAccessToken() {
      if (!accessToken) {
        tokenClient.requestAccessToken();
      } else {
        listFolderContents();
      }
    }

    async function gapiInit() {
      return new Promise((resolve, reject) => {
        gapi.load('client', async () => {
          try {
            await gapi.client.init({
              apiKey: API_KEY,
              discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest']
            });
            resolve();
          } catch (e) {
            reject(e);
          }
        });
      });
    }

    async function listFolderContents() {
      await gapiInit();

      const response = await gapi.client.drive.files.list({
        q: `'${FOLDER_ID}' in parents and trashed = false`,
        fields: 'files(id, name, mimeType, webViewLink, iconLink)'
      });

      const fileList = document.getElementById('fileList');
      fileList.innerHTML = '';

      response.result.files.forEach(file => {
        const li = document.createElement('li');
        li.innerHTML = `<img src="${file.iconLink}" style="vertical-align:middle;margin-right:10px;"> 
                        <a href="${file.webViewLink}" target="_blank">${file.name}</a> 
                        (${file.mimeType.includes('folder') ? 'üìÅ Folder' : 'üìÑ File'})`;
        fileList.appendChild(li);
      });

      if (response.result.files.length === 0) {
        fileList.innerHTML = '<li>No files or folders found in this directory.</li>';
      }
    }

    window.onload = () => {
      if (window.google && google.accounts && google.accounts.oauth2) {
        gisInit();
      } else {
        console.error('Google Identity Services not loaded.');
      }
    };
  </script>
</body>
</html>
