<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Drive Folder Viewer</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f7fa;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding-top: 40px;
      min-height: 100vh;
    }

    .container {
      background: white;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
      width: 90%;
      max-width: 700px;
    }

    h2 {
      text-align: center;
      margin-bottom: 20px;
    }

    ul.file-list {
      list-style: none;
      padding: 0;
    }

    ul.file-list li {
      padding: 12px 0;
      border-bottom: 1px solid #eee;
      display: flex;
      align-items: center;
    }

    ul.file-list li i {
      font-size: 18px;
      margin-right: 10px;
      color: #333;
    }

    ul.file-list li a {
      color: #007bff;
      text-decoration: none;
    }

    ul.file-list li a:hover {
      text-decoration: underline;
    }
  </style>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
  <div class="container">
    <h2>Folder Contents</h2>
    <ul class="file-list" id="fileList">
      <li>Loading...</li>
    </ul>
  </div>

  <script>
    const CLIENT_ID = '608102270412-d1tjhndp3q70b1huig7ulqdmh4uobi5i.apps.googleusercontent.com';
    const API_KEY = 'AIzaSyDWC0fqICusytSBgOqFqtQx0EGpVGP5AFY';
    const FOLDER_ID = '1ET36NM5uLHZ5OS1ZsVRN3kN0NOaEyvbL';
    const SCOPES = 'https://www.googleapis.com/auth/drive.readonly';

    let tokenClient;
    let accessToken = null;
    const fileListEl = document.getElementById('fileList');

    function gisInit() {
      tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: CLIENT_ID,
        scope: SCOPES,
        callback: async (response) => {
          if (response.error) {
            console.error('Token error:', response);
            fileListEl.innerHTML = '<li>Authentication failed.</li>';
            return;
          }
          accessToken = response.access_token;
          await listContents(FOLDER_ID);
        }
      });
    }

    function gapiInit() {
      return new Promise((resolve, reject) => {
        gapi.load('client', async () => {
          try {
            await gapi.client.init({
              apiKey: API_KEY,
              discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest']
            });
            resolve();
          } catch (e) {
            reject(e);
          }
        });
      });
    }

    function requestAccessToken() {
      if (accessToken) {
        listContents(FOLDER_ID);
      } else {
        tokenClient.requestAccessToken();
      }
    }

    async function listContents(folderId) {
      try {
        await gapiInit();
        const response = await gapi.client.drive.files.list({
          q: `'${folderId}' in parents and trashed = false`,
          fields: 'files(id, name, mimeType, webViewLink)',
          orderBy: 'folder,name'
        });

        const files = response.result.files;
        fileListEl.innerHTML = '';

        if (!files || files.length === 0) {
          fileListEl.innerHTML = '<li>No contents found in this folder.</li>';
          return;
        }

        files.forEach(file => {
          const li = document.createElement('li');
          const isFolder = file.mimeType === 'application/vnd.google-apps.folder';

          li.innerHTML = `
            <i class="bi ${isFolder ? 'bi-folder-fill' : 'bi-file-earmark'}"></i>
            <a href="${file.webViewLink}" target="_blank">${file.name}</a>
          `;

          fileListEl.appendChild(li);
        });
      } catch (err) {
        console.error('Error listing contents:', err);
        fileListEl.innerHTML = '<li>Failed to load folder contents.</li>';
      }
    }

    window.onload = () => {
      if (window.google && google.accounts && google.accounts.oauth2) {
        gisInit();
        requestAccessToken();
      } else {
        console.error('Google Identity Services not loaded.');
        fileListEl.innerHTML = '<li>Google API failed to load.</li>';
      }
    };
  </script>
</body>
</html>
